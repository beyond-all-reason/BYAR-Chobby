app-id: info.beyondallreason.bar
runtime: org.freedesktop.Platform
runtime-version: "20.08"
sdk: org.freedesktop.Sdk
  # TODO: Replace shell script call with game launcher
command: hello.sh
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node14
build-options:
  append_path: "/usr/lib/sdk/node14/bin"
  env:
    npm_config_nodedir: /usr/lib/sdk/node14
    npm_config_offline: 'true'
finish-args:
  - --socket=x11
  - --share=ipc
  - --share=network
  - --env=PATH=/usr/bin:/app/bin:/usr/lib/sdk/node14/bin
modules:
  - name: sqlite3
    buildsystem: autotools
    sources:
      - type: archive
        url: https://www.sqlite.org/2021/sqlite-autoconf-3360000.tar.gz
        sha256: bd90c3eb96bee996206b83be7065c9ce19aef38c3f4fb53073ada0d0b69bbce3
  - name: byar-chobby
    buildsystem: simple
    build-commands:
      - pwd && ls -al
      - mkdir /app/bar && mkdir /app/bar/BYAR-Chobby
      - cp -Rp . /app/bar/BYAR-Chobby
    sources:
      - type: git
        url: https://github.com/beyond-all-reason/BYAR-Chobby
        commit: 8546bd567b70eac0445f55f874509ae8427b1de7
  - name: spring-launcher
    buildsystem: simple
    build-commands:
      - pwd && ls -al
      - npm ci --offline --cache=/run/build/spring-launcher-backend/flatpak-node/npm-cache/
      - mkdir /app/bar/spring-launcher
      - cp -Rp . /app/bar/spring-launcher
    sources:
      - type: git
        url: https://github.com/gajop/spring-launcher
        commit: 03d42be4796253ad8d61a68cf946e589e1e0deb6
      - flatpak/generated_source/spring-launcher.json
    build-options:
      env:
        XDB_CACHE_HOME: /run/build/spring-launcher-backend/flatpak-node/cache
        npm_config_cache: /run/build/spring-launcher-backend/flatpak-node/npm-cache
  - name: spring-launcher-backend
    buildsystem: simple
    build-commands:
      - npm ci --offline --cache=/run/build/spring-launcher-backend/flatpak-node/npm-cache/
      - node src/builder/run_build.js beyond-all-reason/BYAR-Chobby --no-generic-backend
    sources:
      - type: git
        url: https://github.com/gajop/spring-launcher-backend
        commit: 6dccaef21a5b9d1db9ee0a584f02f69773f6f560
      - type: patch
        path: flatpak/patch/spring-launcher-backend.patch
      - flatpak/generated_source/spring-launcher-backend.json
    build-options:
      env:
        XDB_CACHE_HOME: /run/build/spring-launcher-backend/flatpak-node/cache
        npm_config_cache: /run/build/spring-launcher-backend/flatpak-node/npm-cache
  # TODO: Replace this with the launcher after the rest works
  - name: hello
    buildsystem: simple
    build-commands:
      - pwd && ls -al
      - node -v
      - install -D hello.sh /app/bin/hello.sh
      - install -D hello.js /app/bin/hello.js
      - node hello.js
      - hello.sh
    sources:
      - type: file
        path: hello.js
      - type: file
        path: hello.sh
